# Weather项目历史文档

## 项目概述

Weather项目是一个自动化工具，主要实现两个核心功能：
1. **自动截取天气网站图片**：利用Playwright自动访问气象网站并截图保存
2. **文件监控与飞书推送**：监控指定目录下的JPG图片，并自动发送到飞书群聊

## 技术架构

项目采用模块化设计，主要组件包括：

### 核心模块
- **weather.py**: 实现文件监控和飞书推送功能
- **weatherPic.py**: 实现天气网站自动截图功能
- **logger.py**: 提供日志记录功能
- **main.py**: 程序入口，集成监控和截图功能

### 技术栈
- **Python 3.x**: 主要开发语言
- **Watchdog**: 文件系统监控库
- **Playwright**: 网页自动化和截图
- **Lark SDK**: 飞书API集成
- **Requests**: HTTP请求处理
- **PIL/Pillow**: 图片处理(可选)

## 功能详情

### 1. 天气网站截图 (weatherPic.py)
- 访问中国气象局网站获取杭州天气信息
- 自动截取今日天气、明日天气和一周天气预报
- 保存为JPG格式图片，使用日期命名

### 2. 文件监控与飞书推送 (weather.py)
- 使用Watchdog库监控指定目录下的JPG文件变化
- 检测到新增或修改的JPG文件后，上传至飞书云存储
- 获取image_key后，通过Webhook发送图片消息至飞书群
- 实现去重机制，避免重复发送相同图片
- 提供完善的错误处理和日志记录

## 项目历史

### 初始版本 (v1.0)
- 实现基本的文件监控功能
- 添加飞书消息发送功能
- 使用简单的文件哈希实现去重

### 功能增强 (v1.1)
- 增加天气网站截图功能
- 改进文件监控逻辑，优化处理流程
- 添加日志记录系统

### 稳定性优化 (v1.2)
- 修复图片上传失败的问题
- 增强错误处理和异常捕获
- 添加详细日志，便于问题诊断
- 支持图片格式验证和转换

### 架构优化 (v1.3)
- 重构代码，提高可维护性
- 优化启动流程，先监控后截图
- 提供了API和直接请求两种上传方式

## 使用说明

1. 安装依赖: `pip install -r requirements.txt`
2. 配置参数: 修改main.py中的目录路径和飞书Webhook URL
3. 运行程序: `python main.py`

## 后续计划

- 支持更多天气网站源
- 添加自定义截图区域功能
- 增加定时任务功能
- 添加Web界面，便于配置和监控

## 维护记录

- 2023-05: 初始版本开发
- 2023-06: 解决图片上传问题
- 2023-07: 优化监控逻辑，增加错误处理
- 2023-08: 代码重构与文档完善 
